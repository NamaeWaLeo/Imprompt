<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Imprompt 설정</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body class="dark-mode">
    <div class="impu-container">
        <h1>Imprompt</h1>

        <div class="impu-tab-bar">
            <button class="impu-tab-button active" data-tab="image-conversion">이미지 변환</button>
            <button class="impu-tab-button" data-tab="settings-info">설정</button>
            <button class="impu-tab-button" data-tab="history">히스토리</button>
            <button class="impu-tab-button" data-tab="about">정보</button>
        </div>

        <div id="impu-image-conversion-tab" class="impu-tab-content active">
            <div class="impu-setting-section">
                <label for="impu-imageUpload" class="impu-setting-label">이미지 파일 업로드 (PNG/JPG):</label>
                <input type="file" id="impu-imageUpload" accept="image/png, image/jpeg, image/jpg" class="impu-neumorphic-input">
                <button id="impu-uploadImageButton" class="impu-neumorphic-button" style="width: 100%; margin-top: 8px;">업로드 및 프롬프트 생성</button>
                <div id="impu-imageUploadStatus" class="impu-status-message"></div>
            </div>

            <div class="impu-setting-section" style="margin-top: 20px;">
                <label class="impu-setting-label">클립보드 이미지 처리:</label>
                <button id="impu-processClipboardImageButton" class="impu-neumorphic-button" style="width: 100%;">클립보드 이미지로 프롬프트 생성</button>
                <div id="impu-clipboardImageStatus" class="impu-status-message"></div>
            </div>
            <div id="impu-popup-prompt-results"></div>
        </div>

        <div id="impu-settings-info-tab" class="impu-tab-content">
            <div class="impu-collapsible-section active">
                <div class="impu-collapsible-header">
                    <h3 class="impu-section-title">Gemini API 설정 <span class="impu-collapse-icon">▼</span></h3>
                </div>
                <div class="impu-collapsible-content">
                    <div class="impu-setting-section">
                        <label for="impu-geminiApiKey" class="impu-setting-label">Gemini API Key:
                            <span class="impu-help-tooltip-wrapper">
                                <span class="impu-help-tooltip-icon">?</span>
                                <span class="impu-help-tooltip-text">
                                    Gemini API를 사용하기 위한 고유 키입니다. <br>
                                    Google AI Studio에서 발급받을 수 있습니다. <br>
                                    (예: `AIzaSy...`)
                                </span>
                            </span>
                        </label>
                        <div class="impu-api-key-input-group">
                            <input type="password" id="impu-geminiApiKey" placeholder="여기에 Gemini API 키를 입력하세요." class="impu-neumorphic-input">
                            <button id="impu-toggleApiKeyVisibility" class="impu-neumorphic-button" style="width: 38px; height: 38px; padding: 0; display: flex; justify-content: center; align-items: center; font-size: 14px;">👁️</button>
                        </div>
                        <button id="impu-saveApiKeyButton" class="impu-neumorphic-button" style="width: 100%; margin-top: 8px;">API 키 저장 및 확인</button>
                        <div id="impu-apiKeyStatus" class="impu-status-message"></div>
                    </div>
                    <div class="impu-setting-section">
                        <label for="impu-geminiModel" class="impu-setting-label">Gemini 모델 선택:
                            <span class="impu-help-tooltip-wrapper">
                                <span class="impu-help-tooltip-icon">?</span>
                                <span class="impu-help-tooltip-text">
                                    프롬프트 생성에 사용할 Gemini 모델을 선택합니다.<br>
                                    'flash' 모델이 'pro' 모델보다 빠르고 저렴하지만, 'pro'는 더 복잡한 추론에 강합니다.
                                </span>
                            </span>
                        </label>
                        <div class="impu-select-wrapper impu-neumorphic-input">
                            <select id="impu-geminiModel">
                                <option value="gemini-1.5-pro">gemini-1.5-pro</option>
                                <option value="gemini-1.5-flash">gemini-1.5-flash</option>
                                </select>
                        </div>
                    </div>
                    <div class="impu-setting-section">
                        <label for="impu-promptLength" class="impu-setting-label">프롬프트 길이:
                            <span class="impu-help-tooltip-wrapper">
                                <span class="impu-help-tooltip-icon">?</span>
                                <span class="impu-help-tooltip-text">
                                    Gemini가 생성할 프롬프트의 길이를 조절합니다.<br>
                                    '짧게'는 핵심만, '매우 길게'는 상세한 설명을 포함합니다.
                                </span>
                            </span>
                        </label>
                        <div class="impu-select-wrapper impu-neumorphic-input">
                            <select id="impu-promptLength">
                                <option value="short">짧게 (Short)</option>
                                <option value="medium">보통 (Medium)</option>
                                <option value="long">길게 (Long)</option>
                                <option value="very-long">매우 길게 (Very Long)</option>
                            </select>
                        </div>
                    </div>
                    <div class="impu-setting-section">
                        <label class="impu-setting-label">프롬프트 추출 방식:
                            <span class="impu-help-tooltip-wrapper">
                                <span class="impu-help-tooltip-icon">?</span>
                                <span class="impu-help-tooltip-text">
                                    이미지에서 프롬프트를 추출하는 방식을 선택합니다.<br>
                                    '메타데이터만': 이미지 내 저장된 정보를 읽습니다.<br>
                                    'Gemini API로 생성': AI가 이미지를 분석하여 생성합니다.<br>
                                    '둘 다': 메타데이터를 우선 추출하고, 없으면 AI를 사용합니다.
                                </span>
                            </span>
                        </label>
                        <div class="impu-position-grid-popup">
                            <label class="impu-neumorphic-radio-label">
                                <input type="radio" name="extractionMethod" value="metadata" id="impu-extMetadata">
                                <span class="impu-custom-radio"></span> 메타데이터만 추출
                            </label>
                            <label class="impu-neumorphic-radio-label">
                                <input type="radio" name="extractionMethod" value="gemini" id="impu-extGemini">
                                <span class="impu-custom-radio"></span> Gemini API로 생성
                            </label>
                            <label class="impu-neumorphic-radio-label">
                                <input type="radio" name="extractionMethod" value="both" id="impu-extBoth" checked>
                                <span class="impu-custom-radio"></span> 둘 다 (기본값)
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="impu-collapsible-section" id="impu-advanced-settings-section">
                <div class="impu-collapsible-header">
                    <h3 class="impu-section-title">고급 설정 <span class="impu-collapse-icon">▶</span></h3>
                </div>
                <div class="impu-collapsible-content">
                    <div class="impu-setting-section impu-custom-prompt-input-group">
                        <label for="impu-customPositivePrompt" class="impu-setting-label">사용자 정의 긍정 프롬프트 (Gemini 결과에 추가):
                            <span class="impu-help-tooltip-wrapper">
                                <span class="impu-help-tooltip-icon">?</span>
                                <span class="impu-help-tooltip-text">
                                    Gemini가 생성하는 긍정 프롬프트에 항상 추가하고 싶은 내용을 입력합니다.<br>
                                    (예: masterpiece, best quality, ultra detailed)
                                </span>
                            </span>
                        </label>
                        <textarea id="impu-customPositivePrompt" class="impu-custom-prompt-textarea" placeholder="masterpiece, best quality, ultra detailed, ... 등"></textarea>
                    </div>

                    <div class="impu-setting-section impu-custom-prompt-input-group">
                        <label for="impu-customNegativePrompt" class="impu-setting-label">사용자 정의 부정 프롬프트 (Gemini 결과에 추가):
                            <span class="impu-help-tooltip-wrapper">
                                <span class="impu-help-tooltip-icon">?</span>
                                <span class="impu-help-tooltip-text">
                                    Gemini가 생성하는 Stable Diffusion 부정 프롬프트에 항상 추가하고 싶은 내용을 입력합니다.<br>
                                    (예: low quality, bad anatomy, blurry)
                                </span>
                            </span>
                        </label>
                        <textarea id="impu-customNegativePrompt" class="impu-custom-prompt-textarea" placeholder="low quality, bad anatomy, blurry, ... 등"></textarea>
                    </div>

                    <div class="impu-setting-section impu-custom-prompt-input-group">
                        <label for="impu-geminiPositiveTemplate" class="impu-setting-label">Gemini 긍정 프롬프트 템플릿:
                            <span class="impu-help-tooltip-wrapper">
                                <span class="impu-help-tooltip-icon">?</span>
                                <span class="impu-help-tooltip-text">
                                    Gemini 모델에게 이미지를 설명하고 긍정 프롬프트를 생성하도록 지시하는 기본 템플릿입니다. 이 템플릿을 수정하여 Gemini의 응답 스타일을 조절할 수 있습니다.<br>
                                    **사용 가능한 변수:**<br>
                                    `{promptLengthInstruction}`: 선택된 프롬프트 길이에 따른 지시사항<br>
                                    `{detailInstruction}`: 상세 설명 지시사항
                                </span>
                            </span>
                        </label>
                        <textarea id="impu-geminiPositiveTemplate" class="impu-custom-prompt-textarea" placeholder="이 이미지에 대한 NovelAI와 Stable Diffusion 프롬프트를 JSON 형식으로 생성해 주세요. {promptLengthInstruction} {detailInstruction}"></textarea>
                    </div>

                    <div class="impu-setting-section impu-custom-prompt-input-group">
                        <label for="impu-geminiNegativeTemplate" class="impu-setting-label">Gemini 부정 프롬프트 템플릿:
                            <span class="impu-help-tooltip-wrapper">
                                <span class="impu-help-tooltip-icon">?</span>
                                <span class="impu-help-tooltip-text">
                                    Gemini 모델에게 부정 프롬프트에 대해 지시하는 템플릿입니다. 수정하여 특정 부정 프롬프트를 제외하도록 강조할 수 있습니다.<br>
                                    이 템플릿은 Stable Diffusion 프롬프트 생성 시 사용됩니다.
                                </span>
                            </span>
                        </label>
                        <textarea id="impu-geminiNegativeTemplate" class="impu-custom-prompt-textarea" placeholder="**부정적인 프롬프트**: 절대 적지 마세요. (예: bad hand, bad eyes)."></textarea>
                    </div>

                </div>
            </div>
            
            <button id="impu-saveOtherSettingsButton" class="impu-neumorphic-button" style="width: 100%; margin-top: 25px;">설정 저장</button>
            <div id="impu-otherSettingsStatus" class="impu-status-message"></div>

            <div class="impu-setting-section" style="margin-top: 20px;">
                <button id="impu-resetAllSettingsButton" class="impu-neumorphic-button" style="background-color: var(--status-error-bg); border-color: var(--status-error-bg); width: 100%;">모든 설정 초기화</button>
            </div>
        </div>

        <div id="impu-history-tab" class="impu-tab-content">
            <h2 style="color: var(--text-color); text-align: center; margin-bottom: 15px; font-weight: 600;">프롬프트 히스토리</h2>
            <ul id="impu-promptHistoryList" class="impu-history-list">
                </ul>
            <div id="impu-noHistoryMessage" style="color: var(--text-color-light); text-align: center; margin-top: 15px; display: none; font-size: 14px;">
                저장된 프롬프트 히스토리가 없습니다.
            </div>
            <div class="impu-setting-section" style="margin-top: 20px;">
                <button id="impu-clearAllHistoryButton" class="impu-neumorphic-button" style="background-color: var(--status-warning-bg); border-color: var(--status-warning-bg); width: 100%;">히스토리 전체 삭제</button>
            </div>
        </div>

        <div id="impu-about-tab" class="impu-tab-content">
            <h2 style="color: var(--text-color); text-align: center; margin-bottom: 15px; font-weight: 600;">Imprompt 정보</h2>
            <p style="color: var(--text-color-light); text-align: center; line-height: 1.6; font-size: 14px;">
                Imprompt는 복사한 이미지를 Gemini AI를 이용하여<br>
                NovelAI 및 Stable Diffusion 프롬프트로 변환해주는 확장 프로그램입니다.<br><br>
                피드백이나 문의사항은 이쪽의 Github에 Issue로 남겨주세요.
                디자인은 대부분 Gemini한테 css 적어달라 했습니다. 생각보다 잘하더라고요.
            </p>
            <div class="impu-version-info" style="margin-top: 25px;">
                버전: <span id="impu-version">1.3.0</span><br>
                제작자: <a href="https://github.com/NamaeWaLeo/Imprompt" target="_blank" style="color: var(--primary-color); text-decoration: none;">NamaeWaLeo</a>
            </div>
        </div>
    </div>

    <script src="popup.js"></script>
</body>
</html>